<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../assets/style.css" />
    <title><%=data.username %> | Server Picker</title>
    <meta content="<%=data.username %> Dashboard" property="og:title" />
    <meta
      content="Login with Discord to view this page."
      property="og:description"
    />
    <meta content="#7289da" data-react-helmet="true" name="theme-color" />
    <style>
      .avatar {
        border-radius: 5px;
      }
      .guild-text p {
        display: flex;
        text-align: center;
        flex-direction: column;
        justify-content: center;
        max-width: 75%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: fade;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      ul.guild-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 5rem;
        padding: 0;
      }
      li {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 10px;
        max-width: 300px;
        width: 100%;
      }
      .guild-containers {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        padding: 8px;
        background-color: #36393e;
        transition: all 0.3s;
        flex: 1;
        -webkit-user-drag: none;
        width: 100%;
        position: relative;
        overflow: hidden;
        margin-bottom: 20px;
      }
      .guild-containers .guild-box {
        position: relative;
        width: 100%;
        height: 150px;
        overflow: hidden;
        background-size: cover;
        background-position: center;
      }
      .guild-containers .guild-box img {
        width: 100%;
        height: auto;
        filter: blur(5px);
        border-radius: 8px;
      }
      li h3 {
        margin: 0;
        font-size: 18px;
      }
      .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 20px;
        background-color: #36393e;
        text-align: center;
      }
      button {
        color: #fff;
        padding: 10px 20px;
        margin: 10px auto;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        background-color: #7289da;
        transition: color 0.3s, background-color 0.3s;
      }
      button:hover {
        background-color: #5a68a5;
        transition: color 0.3s, background-color 0.3s;
      }
    </style>
  </head>
  <body>
    <div class="navbar">
      <a
        href="/"
        style="color: #fff; text-decoration: none"
        class="avatar-container-navbar"
      >
        <img class="avatar-navbar" src="<%=data.avatar %>" alt="Avatar" />
        <div class="avatar-text"><%=data.username %></div>
      </a>
      <div class="navbar-links">
        <% for (const item of sidebar) { %> <% const { title, to, href, html } =
        item; %> <% if (html) { %> <%- html %> <% } else if (href) { %>
        <a class="navbar-link" href="<%= href %>"><%= title %></a>
        <% } else { %>
        <a class="navbar-link" href="<%= to.startsWith('/') ? to : '/' + to %>"
          ><%= title %></a
        >
        <% } %> <% } %> <% if (data.auth) { %>
        <div class="rounded-border">
          <div class="avatar-container-navbar">
            <a
              class="login-button"
              style="vertical-align: middle"
              href="/auth/logout"
            >
              <img
                class="avatar-navbar-small"
                src="<%=data.user.avatar %>"
                alt="Avatar"
              />
              <%= data.user.username %>
            </a>
          </div>
        </div>
        <% } else { %>
        <div class="rounded-border">
          <a class="login-button" href="/auth/login">Login with Discord</a>
        </div>
        <% } %>
      </div>
    </div>
    <ul class="guild-list">
      <% if (guildData.length === 0) { %>
      <p>No guilds available.</p>
      <% } else { %> <% for (const guild of guildData) { %>
      <li>
        <% const canManageServer = guild.permissions.includes('Administrator')
        || guild.permissions.includes('ManageServer'); %>
        <div class="guild-containers">
          <div class="guild-box">
            <img src="<%= guild.bannerURL %>" alt="Guild Icon" />
          </div>
          <div class="guild-text">
            <p>
              <% if (guild.guildName.length > 20) { %> <%=
              guild.guildName.substring(0, 25) %> <% } else { %> <%=
              guild.guildName %> <% } %>
            </p>
            <% if (guild.botInServer) { %>
            <button class="manage-server">Manage Server</button>
            <% } else { %>
            <button class="invite">Invite</button>
            <% } %>
          </div>
        </div>
      </li>
      <% } %> <% } %>
    </ul>
  </body>
  <script>
    /*
    document.addEventListener("DOMContentLoaded", () => {
      const guildContainers = document.querySelectorAll(".guild-containers");
      guildContainers.forEach((container) => {
        if (container.id.split("-")[0] === "noaccess") return;
        const guildId = container.id.split("-")[1];
        container.addEventListener("click", () => {
          window.location.href = "/dash/guilds/" + guildId;
        });
      });
    });
    */
  </script>
</html>
